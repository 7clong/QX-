#!name=QX · Subscription Tap
#!desc=只抓三类订阅接口：/v1/subscribers/{user_id}、/v1/receipts、/v1/offerings。仅记录请求与响应，不修改任何内容，用于还原订阅验证流程。
#!author=QuantumultX 规则工程师
#!version=2025.08.25

# 使用说明（重要且简短）：
# 1) 你必须在 Quantumult X → MitM 中开启证书并信任；把目标 App 实际用到的域名加进 MitM 列表，否则 HTTPS 抓不到包。
# 2) 本模块仅匹配路径，不限定域名，避免维护成本。命中后把请求/回包写入日志与持久化存储（最多20条，默认）。
# 3) 不会改包、不退订、不解锁。只是“录音笔”。

# 可选：如果你已经知道域名，可以把它们写在这一行里，导入时会自动并入 MitM：
# hostname = api.example.com, edge.examplecdn.com

# ---------- Subscribers ----------
^https?:\/\/[^\/]+\/v1\/subscribers\/[^\/\?]+(\?.*)?$ url script-request-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=15, tag=SubTap · subscribers · req
^https?:\/\/[^\/]+\/v1\/subscribers\/[^\/\?]+(\?.*)?$ url script-response-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=20, tag=SubTap · subscribers · resp

# ---------- Receipts ----------
^https?:\/\/[^\/]+\/v1\/receipts(\?.*)?$ url script-request-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=15, tag=SubTap · receipts · req
^https?:\/\/[^\/]+\/v1\/receipts(\?.*)?$ url script-response-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=20, tag=SubTap · receipts · resp

# ---------- Offerings ----------
^https?:\/\/[^\/]+\/v1\/offerings(\?.*)?$ url script-request-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=15, tag=SubTap · offerings · req
^https?:\/\/[^\/]+\/v1\/offerings(\?.*)?$ url script-response-body https://raw.githubusercontent.com/7clong/QX-/main/QX_Subscription_Tap.js, requires-body=true, timeout=20, tag=SubTap · offerings · resp

# 可选开关（在 QX → 持久化数据里设置）
# QX_SubTap_Notify = 1     命中时发系统通知（默认 0 不打扰）
# QX_SubTap_LogMax = 20     持久化保存最近 N 条（默认 20）
