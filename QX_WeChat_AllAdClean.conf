#!name=QX · WeChat All AdClean
#!desc=微信去广告合辑：公众号文章 + 朋友圈（保守、不碰聊天/支付）。conf 远程订阅版（根目录方案）
#!author=QuantumultX 规则工程师
#!version=2025.08.22

# 合并需要的主机名（MitM 必开并信任证书）
hostname = mp.weixin.qq.com, adsmp.weixin.qq.com

# —— 公众号文章 ——
# 清理 getappmsgext 返回里的广告字段（脚本仅删 ad 相关键）
^https?:\/\/mp\.weixin\.qq\.com\/mp\/getappmsgext(\?|$) url script-response-body https://raw.githubusercontent.com/7clong/QX-/main/wx-all-adclean.js
# 文章广告拉取接口：空对象最稳妥
^https?:\/\/mp\.weixin\.qq\.com\/mp\/getappmsgad(\?|$) url reject-dict
# 旧/灰度广告接口：存在即杀
^https?:\/\/mp\.weixin\.qq\.com\/mp\/advertisement(\?|$) url reject-dict
# 相关推荐里若单独下发广告数组：回空数组
^https?:\/\/mp\.weixin\.qq\.com\/mp\/(related|recommend|ad_|ads?)(\w+)?(\?|$) url reject-array

# —— 朋友圈（Moments） ——
# 朋友圈广告域：adsmp.weixin.qq.com 下发广告位与素材
# 为避免误杀，仅对包含 ad/ads/advert/promotion 的路径做响应体净化，不改其余业务接口。
^https?:\/\/adsmp\.weixin\.qq\.com\/.+(ad|ads|advert|promotion)[^\/?]*(\?|$) url script-response-body https://raw.githubusercontent.com/7clong/QX-/main/wx-all-adclean.js
# 常见广告聚合/合并接口，直接回空数组更稳妥
^https?:\/\/adsmp\.weixin\.qq\.com\/.+/(getad|ads|adlist|ad_list|adcombine|ad_combine)(\?|$) url reject-array
